---
title: "Build Database"
author: "David Ory"
output:
  html_document:
    theme: cosmo
    toc: yes
---

## Administration

#### Purpose
`Build Annual Database.Rmd` creates two year-specific databases of typical weekday PeMS traffic data.  One database has hourly summaries and the other has time-period summaries.  This script combines these databases across years and writes out a two consolidated databases in `Rdata` and `CSV` format. 

#### _ISSUES_
1. 

#### _TODO_
2.  Bring in GIS lats/longs for off-sets  -- are these better?
3.  Put in tableau --> push
4.  Update Wiki references
5.  Take down ArcGIS on-line
6.  Take down GeoCommons


## Overhead

#### Libraries
```{r overhead}
library(knitr)
```

#### Knitr config
```{r config, include=FALSE}
knitr::opts_chunk$set(cache=TRUE)
```

#### Remote file names
```{r file-names}
# Year 2005 data
YEAR = 2005
F_2005_HOUR_R   = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_hour_",YEAR,".Rdata", sep = "")
F_2005_PERIOD_R = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_period_",YEAR,".Rdata", sep = "")

# Year 2009 data
YEAR = 2009
F_2009_HOUR_R   = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_hour_",YEAR,".Rdata", sep = "")
F_2009_PERIOD_R = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_period_",YEAR,".Rdata", sep = "")

# Year 2010 data
YEAR = 2010
F_2010_HOUR_R   = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_hour_",YEAR,".Rdata", sep = "")
F_2010_PERIOD_R = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_period_",YEAR,".Rdata", sep = "")

# Year 2011 data
YEAR = 2011
F_2011_HOUR_R   = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_hour_",YEAR,".Rdata", sep = "")
F_2011_PERIOD_R = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_period_",YEAR,".Rdata", sep = "")

# Year 2012 data
YEAR = 2012
F_2012_HOUR_R   = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_hour_",YEAR,".Rdata", sep = "")
F_2012_PERIOD_R = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_period_",YEAR,".Rdata", sep = "")

# Year 2013 data
YEAR = 2013
F_2013_HOUR_R   = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_hour_",YEAR,".Rdata", sep = "")
F_2013_PERIOD_R = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_period_",YEAR,".Rdata", sep = "")

# Year 2014 data
YEAR = 2014
F_2014_HOUR_R   = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_hour_",YEAR,".Rdata", sep = "")
F_2014_PERIOD_R = paste("M:/Data/Traffic/PeMS/",YEAR,"/pems_period_",YEAR,".Rdata", sep = "")

# Ouput 
F_OUTPUT_HOUR_R   = "M:/Data/Traffic/PeMS/pems_hour.Rdata"
F_OUTPUT_HOUR_CSV = "M:/Data/Traffic/PeMS/pems_hour.csv"

F_OUTPUT_PERIOD_R   = "M:/Data/Traffic/PeMS/pems_period.Rdata"
F_OUTPUT_PERIOD_CSV = "M:/Data/Traffic/PeMS/pems_period.Rdata"
```

## Bind and Write
```{r merge-write}
# Hour data
load(F_2005_HOUR_R)
hour_2005 <- data_sum_hour_write

load(F_2009_HOUR_R)
hour_2009 <- data_sum_hour_write

load(F_2010_HOUR_R)
hour_2010 <- data_sum_hour_write

load(F_2011_HOUR_R)
hour_2011 <- data_sum_hour_write

load(F_2012_HOUR_R)
hour_2012 <- data_sum_hour_write

load(F_2013_HOUR_R)
hour_2013 <- data_sum_hour_write

load(F_2014_HOUR_R)
hour_2014 <- data_sum_hour_write

hour_all <- rbind(hour_2005, hour_2009, hour_2010, hour_2012, hour_2013, hour_2014)

save(hour_all, file = F_OUTPUT_HOUR_R)
write.csv(hour_all, file = F_OUTPUT_HOUR_CSV, row.names = FALSE, quote = T)

# Period data
load(F_2005_PERIOD_R)
period_2005 <- data_sum_period_write

load(F_2009_PERIOD_R)
period_2009 <- data_sum_period_write

load(F_2010_PERIOD_R)
period_2010 <- data_sum_period_write

load(F_2011_PERIOD_R)
period_2011 <- data_sum_period_write

load(F_2012_PERIOD_R)
period_2012 <- data_sum_period_write

load(F_2013_PERIOD_R)
period_2013 <- data_sum_period_write

load(F_2014_PERIOD_R)
period_2014 <- data_sum_period_write

period_all <- rbind(period_2005, period_2009, period_2010, period_2011, period_2012, period_2013, period_2014)

save(period_all, file = F_OUTPUT_PERIOD_R)
write.csv(period_all, file = F_OUTPUT_PERIOD_CSV)

```

```{r debug}
# START HERE

```

